# 🧪 变量替换修复测试指南

## 📋 **测试目标**

验证高优先级问题的修复效果：
1. ✅ 选择状态问题修复
2. ✅ 文件状态问题修复  
3. ✅ 错误处理改进

---

## 🔍 **测试场景1: 选择状态问题**

### 📝 **测试步骤**
1. 打开任意文件
2. **不要选中任何文本**
3. 运行命令：`测试系统变量（直接）`
4. 在输入框中输入：`当前选中的文本是：{{selection}}`

### ✅ **预期结果**
- 应该显示警告消息：`"提示：模板包含 {{selection}} 变量，但当前没有选中任何文本。建议先选中一些文本后再使用。"`
- 最终结果应该是：`当前选中的文本是：`（空字符串）

### 🔄 **对比测试**
1. 选中一些文本，重复上述步骤
2. 应该正常显示选中的内容，不显示警告

---

## 🔍 **测试场景2: 文件状态问题**

### 📝 **测试步骤A: 未保存文件**
1. 创建新文件（Ctrl+N）
2. 不要保存
3. 运行命令：`测试系统变量（直接）`
4. 输入：`文件名：{{filename}}，路径：{{filepath}}`

### ✅ **预期结果A**
- 文件名应该显示为：`未保存文件-new` 或类似格式
- 路径应该显示为：`untitled:new` 或类似格式
- 不应该出现错误或空值

### 📝 **测试步骤B: 普通文件**
1. 打开已保存的文件
2. 重复上述测试
3. 对比结果

### ✅ **预期结果B**
- 文件名应该显示实际文件名
- 路径应该显示完整文件路径

---

## 🔍 **测试场景3: 错误处理改进**

### 📝 **测试步骤A: 用户取消输入**
1. 创建包含自定义变量的模板
2. 运行使用该模板的命令
3. 当弹出输入框时，按 `Esc` 取消输入
4. 重复多次，测试不同变量类型

### ✅ **预期结果A**
- 应该显示友好的警告消息
- 应该使用默认值而不是崩溃
- 不应该影响其他变量的处理

### 📝 **测试步骤B: 必填项取消**
1. 设置必填的自定义变量
2. 运行命令，取消输入
3. 检查处理结果

### ✅ **预期结果B**
- 应该显示特定的必填项警告消息
- 应该回退到默认值

---

## 🚀 **快速测试命令**

### 1️⃣ **测试选择状态**
```
命令：测试系统变量（直接）
输入：选中内容：{{selection}}，长度：{{selection.length}}
```

### 2️⃣ **测试文件状态**
```
命令：测试系统变量（直接）
输入：文件：{{filename}} 位于 {{filepath}}
```

### 3️⃣ **测试综合场景**
```
命令：测试系统变量（直接）
输入：
在文件 {{filename}} 中，
选中的内容是："{{selection}}"，
完整路径：{{filepath}}
```

---

## 📊 **测试报告模板**

### ✅ **通过的测试**
- [ ] 选择状态警告显示正确
- [ ] 未保存文件名处理正确
- [ ] 用户取消输入处理正确
- [ ] 必填项警告显示正确

### ❌ **失败的测试**
记录任何意外行为或错误消息

### 💡 **改进建议**
记录用户体验方面的改进建议

---

## 🔧 **调试信息**

如果遇到问题，查看开发者控制台（Help > Toggle Developer Tools > Console）中的调试信息：
- 🔧 开头的消息显示变量处理过程
- ⚠️ 开头的消息显示警告信息
- Error 消息显示错误信息

---

## 📈 **成功标准**

修复被认为成功，当：
1. 所有警告消息都友好且有帮助
2. 不再有意外的空值或错误
3. 用户取消操作时系统优雅降级
4. 特殊文件状态得到正确处理
5. 用户体验显著改善

---

*测试指南版本: 1.0*
*对应修复版本: 2024-01-XX* 